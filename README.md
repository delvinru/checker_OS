# Отмечалка на паре

Бот для телеграмма, который поможет удобно отмечать людей на занятии с помощью OTP-QR кодов.

Такой подход не дает возможности студентам не на паре отметиться, поскольку время генерации кодов очень короткое, следовательно исключается возможность сфотографировать код и отправить другому студенту.

------
#### Установка и запуск

Программа запускается в `Docker` контейнере. Перед запуском необходимо создать файл `.env`, в который нужно положить свой телеграмм-токен.

##### Подготовка к запуску:

```bash
git clone https://github.com/delvinru/telegram_otp_check.git
cd telegram_otp_check/
echo "OTP_CHECK_TOKEN=<YOUR:TELEGRAM_TOKEN>" > .env
```

Также не забудьте поменять имя бота в файле `bot/lib/settings.py` на своё.

```python
BOT_NAME = 'kks_checker_bot'
...
```

##### Запуск:

```bash
docker-compose up --build -d
```

Теперь бот запущен, можно зайти по адресу `http://localhost:8080` и показывать QR-код студентам.

------
#### Устройство бота

Бот имеет серверную часть, которая лежит в папке `bot`, и веб-сервер, который лежит в папке `www`.

При запуске вываливается `Warning`. На него можно не обращать внимание. Поскольку это не чат бот, то нам не нужно отлавливать все сообщения. Собственно, об этом нас и предупреждает этот `Warning`.

Бот также автоматически стартует `web-server` по адресу `http://127.0.0.1:8080/`, который поднимается локально и не доступен из вне.

------
#### Настройка бота 

В настройках можно менять имя бота `BOT_NAME`, измени на имя вашего бота, время обновления QR-кода `REFRESH_TIME`, по умолчанию стоит на `15` секунд.

------
#### Хранение данных

Данные о пользователях хранятся в базе данных `bot/db/students.sqlite`. С помощью временных меток в базе данных можно получать пользователей в определённый промежуток времени, например соотнося со временем пары.

Также бот собирает логи, которые можно посмотреть в папке `bot/logs/`.

------
#### Примеры

Как выглядит фронт часть, которую видят студенты. Чтобы избежать статики, для привлечения внимания студентов были сделаны анимация эффекта матрицы и гиф анимация с ожидающим котом.

![qr_screen](docs/qr_screen.png)

Так выглядит часть, которая видна преподавателю. На картинке ниже можно наблюдать функциональность бота, ведется полное логирование действий пользователя.

(Данное экран в данный момент нельзя увидеть, т.к. бот запускается в докере).

![server_screen](docs/bot.png)

Полезная функция, это выявление студентов, которые попытались зайти либо по некорректному qr, либо попытались сделать это 3 и более раз. Увидеть это можно с помощью цветовых индикаторов, жёлтым цветом помечается некорректный вход, красным цветом - подозрительный студент.

------
#### Админка
Также для преподавателя существует панель администратора, где можно просто указав время начала и конца занятия выбрать всех студентов, которые отметились в этот период времени.

Попасть на эту страницу можно по адресу `http://127.0.0.1:8080/admin`. Поскольку данная страница запущена локально, то нет нужны проводить этапы авторизации и аутентификации.

![admin_page](docs/admin_page.png)